# Reviewer Service

## Запуск проекта

### 1. Клонируйте репозиторий

```sh
git clone https://github.com/wrzdx/reviewer-service.git
cd reviewer-service
```

### 2. Создайте файл окружения

В репозитории есть готовый шаблон:

```sh
cp template.env .env
```

Файл содержит необходимые переменные для локального запуска.

### 3. Установите зависимости Go

```sh
go mod tidy
```

### 4. Запуск сервисов через Docker Compose

```sh
make docker-up # если нет make то вручную запускать команды в Makefile
```

После старта сервис будет доступен на:

```
http://localhost:8080
```

### 5. Запуск тестов

Интеграционные и e2e тесты можно выполнить:

```sh
make test
```

---

## Структура Makefile

Makefile содержит стандартные команды:

* `make build` — сборка бинаря `reviewer-service`
* `make run` — запуск без Docker
* `make docker-up` — запуск с Docker
* `make docker-down` — остановить Docker
* `make test` — запуск тестов
* `make lint` — запуск линтера
* `make lint-fix` — запуск линтера с исправлением

---


## Проблемы и решения: 

### Проблема: инициализация схемы базы данных

При развёртывании сервиса Postgres поднимался с пустой базой данных. Это приводило к ошибкам на этапе запуска приложения, поскольку необходимые таблицы отсутствовали. Ручное выполнение SQL-скриптов нарушало повторяемость и усложняло локальное окружение.

### Решение

Для автоматической инициализации базы данных был использован стандартный механизм миграций, доступный в официальном образе `postgres`. В `docker-compose.yml` SQL-файл со схемой был смонтирован в директорию `/docker-entrypoint-initdb.d/`:

```yaml
db:
  image: postgres:15
  restart: always
  env_file:
    - .env
  ports:
    - "5432:5432"
  volumes:
    - db-data:/var/lib/postgresql/data
    - ./app/db/migrations.sql:/docker-entrypoint-initdb.d/migrations.sql
```

При первом запуске контейнера `postgres` автоматически выполняет скрипт `migrations.sql`, создавая все необходимые таблицы и объекты. Это обеспечивает предсказуемое состояние базы данных без дополнительного вмешательства и гарантирует одинаковое поведение окружения у всех участников проекта.

